<!doctype html>
<title>Hello World!</title>
<style>
body {
    width: 100%;
    height: 100%;
    background-color: #eee;
}

.chat {
    background-color: #fff;
    height: 100%;
    max-height: 450px;
    margin: 40px auto;
    width: 100%;
    max-width: 400px;
}

.messages {
    height: 400px;
    overflow-y: scroll;
}

.send-message {
    text-align: center;
}

.send-button {
    cursor: pointer;
}
</style>
<div class="chat">
<div class="messages">
<ul class="message-list">
    <li>Do you want to have a little talk?</li>
</ul>
</div>
<form class="send-message">
    <input type="text" placeholder="Say what you need to say" name="message" class="message-input">
    <a role="button" class="send-button">Send</a>
</form>
</div>
<script   src="https://code.jquery.com/jquery-3.0.0.min.js"   integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0="   crossorigin="anonymous"></script>
<script>
    'use strict'

    let button = $('.send-button')
    let messageInput = $('.message-input')[0]
    let msgList = $('.message-list')[0]
    let form = $('form')
    let confirmation = true

    function addMessage(text, className='') {
        let li = document.createElement('LI')
        li.appendChild(document.createTextNode(text))
        li.className = className
        msgList.appendChild(li)
    }

    function submitMessage(e) {
        e.preventDefault()
        let message = messageInput.value.trim()
        if (message) {
            addMessage(message)
            $.post('/bot', {
                message,
                confirmation
            }, (data) => {
                let finish = data.finish
                if (finish) {
                    form.hide()
                } else {
                    confirmation = data.confirmation
                    addMessage(data.text)
                }
            })
            // fetch('/bot', {
            //     method: 'POST',
            //     body: new FormData(form)
            // })
            // .then(response => response.json())
            // .then(response => {

            // })
            // .catch(err => console.log(err))
        }
        messageInput.value = ''
    }

    $('form').submit(submitMessage)
    $('.send-button').click(submitMessage)
</script>